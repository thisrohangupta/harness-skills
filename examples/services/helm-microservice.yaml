# Helm-based Microservice Example
# Service deployed via Helm chart with ECR artifact

service:
  identifier: payment_service
  name: Payment Service
  description: Payment processing microservice using Helm deployment
  tags:
    team: payments
    tier: backend
    pci_compliant: "true"
  serviceDefinition:
    type: NativeHelm
    spec:
      manifests:
        - manifest:
            identifier: helm_chart
            type: HelmChart
            spec:
              store:
                type: Http
                spec:
                  connectorRef: helm_repo_connector
              chartName: payment-service
              chartVersion: <+input>
              helmVersion: V3
              skipResourceVersioning: false
              commandFlags:
                - commandType: Install
                  flag: --timeout 10m
                - commandType: Upgrade
                  flag: --timeout 10m --atomic
        - manifest:
            identifier: values_override
            type: Values
            spec:
              store:
                type: Github
                spec:
                  connectorRef: github_connector
                  repoName: payment-service
                  branch: main
                  paths:
                    - helm/values-<+env.name>.yaml
      artifacts:
        primary:
          primaryArtifactRef: <+input>
          sources:
            - identifier: ecr_image
              type: Ecr
              spec:
                connectorRef: aws_connector
                region: us-east-1
                imagePath: payment-service
                tag: <+input>
      variables:
        - name: STRIPE_API_KEY
          type: Secret
          value: <+secrets.getValue("stripe_api_key")>
        - name: ENABLE_3DS
          type: String
          value: "true"
