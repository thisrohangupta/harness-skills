# AWS Lambda Serverless Service Example
# Serverless function deployed to AWS Lambda

service:
  identifier: notification_lambda
  name: Notification Lambda
  description: Serverless notification service for email and SMS
  tags:
    team: platform
    tier: serverless
    runtime: nodejs18
  serviceDefinition:
    type: ServerlessAwsLambda
    spec:
      manifests:
        - manifest:
            identifier: serverless_manifest
            type: ServerlessAwsLambda
            spec:
              store:
                type: Github
                spec:
                  connectorRef: github_connector
                  repoName: notification-service
                  branch: main
                  paths:
                    - serverless.yml
              configOverridePath: config/<+env.name>.yml
      artifacts:
        primary:
          primaryArtifactRef: <+input>
          sources:
            - identifier: s3_artifact
              type: AmazonS3
              spec:
                connectorRef: aws_connector
                region: us-east-1
                bucketName: lambda-artifacts-bucket
                filePath: notification-service/<+pipeline.variables.version>/function.zip
      variables:
        - name: SENDGRID_API_KEY
          type: Secret
          value: <+secrets.getValue("sendgrid_api_key")>
        - name: TWILIO_SID
          type: Secret
          value: <+secrets.getValue("twilio_sid")>
        - name: TWILIO_TOKEN
          type: Secret
          value: <+secrets.getValue("twilio_token")>
        - name: FROM_EMAIL
          type: String
          value: noreply@example.com
